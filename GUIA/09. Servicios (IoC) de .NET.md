# Tiempos de vida de Servicios

Estas son las tres duraciones de tiempo de vida (lifetimes) principales para el registro de servicios en el contenedor de Inversión de Dependencias (IoC) de .NET (Core/5+). Definen cuándo se crea una nueva instancia de un servicio y cuándo se destruye.

1. Transient (Cada vez que se pide.)
   Definición: Se crea una nueva instancia del servicio cada vez que se solicita.
   Uso Común: Servicios ligeros, sin estado (stateless) o que deben ser completamente independientes para cada operación (ej. operaciones matemáticas, validadores).
   Método: services.AddTransient<IServicio, Servicio>()
   Ejemplo: Si un controlador y un servicio dentro de ese controlador solicitan el servicio Transient, cada uno recibirá una instancia diferente.

2. Scoped (Por cada petición HTTP.)
   Definición: Se crea una única instancia por cada solicitud HTTP (request).
   Uso Común: Servicios que necesitan mantener el estado dentro del contexto de una única operación web. Es el más común para servicios de lógica de negocio y repositorios de datos (como tu PersonajeRepository), ya que a menudo dependen de un DbContext que también es Scoped.
   Método: services.AddScoped<IServicio, Servicio>()
   Ejemplo: Dentro del manejo de una única petición web, si un controlador, dos servicios y un middleware solicitan el servicio Scoped, todos recibirán la misma instancia.

3. Singleton (Una vez al inicio de la app.)
   Definición: Se crea una única instancia de servicio para toda la vida de la aplicación (desde que se inicia hasta que se detiene).
   Uso Común: Servicios de configuración, caché en memoria, o servicios que son inherentemente seguros para subprocesos (thread-safe) y deben compartir datos de forma global.
   Método: services.AddSingleton<IServicio, Servicio>()
   Ejemplo:1 No importa cuántas peticiones HTTP lleguen, ni cuántos componentes lo pidan; todos recibirán l misma instancia durante toda la vida de la aplicación.

Ejemplo: En program.cs (sector servicios)

```csharp
// Le decimos: "Cuando alguien pida un IPersonajeRepository, entrégale una instancia de PersonajeRepository"
//AddScoped crea una instancia por cada petición, evitando errores y conflictos cuando varios usuarios acceden a la API simultáneamente.
builder.Services.AddScoped<IPersonajeRepository, PersonajeRepository>();
```
